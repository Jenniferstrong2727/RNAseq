# MiBrain RNA-seq Analysis Pipelines (Minerva)

This repository contains reproducible RNA-seq analysis pipelines developed for the **MiBrain iPSC-derived model system**, designed for execution on the **Minerva HPC cluster**.

The repository is organized into two primary workflows aligned with project aims:

1. **Bulk RNA-seq analysis**
2. **Single-cell RNA-seq analysis**, including cell-type–specific and pseudobulk downstream analyses

---

# 1. Bulk RNA-seq Pipeline (MiBrain / Minerva)

The bulk RNA-seq pipeline supports preprocessing, alignment, quantification, differential expression, and pathway analysis for bulk RNA-seq datasets.

---

## 1.1 Pipeline overview

1. **RAPiD** — preprocessing, QC, alignment, and quantification  
2. **Sample collation** — combine gene-level count matrices  
3. **Differential expression analysis**  
4. **Pathway and gene-set enrichment analysis**

---

## 1.2 Folder structure (Bulk)

```text
Bulk/
├── scripts/
│   ├── 00_run_RAPiD.sh
│   ├── 01_collate_samples.R
│   ├── BULK_rnaseq_DEG.R
│   └── BULK_rnaseq_pathway_1.R
└── docs/
    ├── RAPiD_details.md
    ├── RAPiD_tips_jen.md
    └── DEG_pathway_details.md
```

---

## 1.3 RAPiD — preprocessing / alignment / QC

RAPiD performs:

- Adapter trimming (Trimmomatic)
- QC (FastQC, Picard)
- Alignment (STAR)
- Gene quantification (featureCounts, Salmon, Kallisto, RSEM)
- Splicing analysis (LeafCutter)
- Aggregated QC reporting (MultiQC)

**Documentation:**
- `Bulk/docs/RAPiD_details.md`
- `Bulk/docs/RAPiD_tips_jen.md`

---

## 1.4 Differential expression analysis (DESeq2)

**Script:**  
`Bulk/scripts/BULK_rnaseq_DEG.R`

**Inputs:**
- featureCounts matrix  
- Sample metadata  

**Outputs:**
- Raw DEG results  
- Shrunk logFC results  
- QC plots and summary tables  

---

## 1.5 Pathway analysis (GSEA + ORA)

**Script:**  
`Bulk/scripts/BULK_rnaseq_pathway_1.R`

Performs:
- GSEA (fgseaMultilevel)
- Over-representation analysis (KEGG, GO, Hallmark)
- Standard enrichment visualizations

---

# 2. Single-cell RNA-seq Pipeline (MiBrain / Minerva)

Preprocessing, QC, integration, clustering, annotation, and downstream cell-type–specific analyses for MiBrain scRNA-seq data.

---

## 2.1 Pipeline overview (exact order)

1. **Cell Ranger** — alignment and gene-level quantification  
2. **CellBender** — ambient/background RNA removal  
3. **QC and filtering** (per-sample)  
4. **Seurat + Harmony integration, clustering, and annotation**  
5. **Cell-type–specific downstream analyses** (e.g., microglia)

---

## 2.2 Single-cell RNA-seq workflow overview

The single-cell workflow supports end-to-end analysis of MiBrain scRNA-seq data on Minerva, from raw FASTQs to integrated objects and cell-type–specific statistical analyses.

Core stages include:

- Cell Ranger preprocessing
- CellBender background RNA correction
- Per-sample QC and filtering
- Seurat + Harmony integration and annotation
- Cell-type–specific downstream analyses (currently focused on microglia)

Downstream microglia analyses include:

- Subsetting and reclustering
- Pseudobulk differential expression (DREAM and edgeR)
- Abundance testing (Propeller)
- Gene-set testing accounting for inter-gene correlation (CAMERA)

Detailed documentation, script descriptions, and execution order are provided in:

`Single_Cell/README.md`

---

## 2.3 Folder structure (Single-cell)

```text
Single_Cell/
├── scripts/
│   ├── run_cellranger_all.sh
│   ├── run_cellbender_all.sh
│   ├── miBrain_QC_filtering.R
│   ├── QC_filtering_integration_clustering.R
│   ├── Seurat_integration_harmony.R
│   ├── microglia_subset_signatures.R
│   ├── Pseudobulk_Dream_Pathway_analysis.R
│   ├── Pseudobulk_edgeR.R
│   └── Propeller_Camera.R
└── docs/
    └── (analysis notes, troubleshooting, version info)
```

---

## 2.4 Example MiBrain single-cell project layout (Minerva)

```text
/sc/arion/projects/ad-omics/Jennifer/scRNA_mibrain_P2RY12
├── 00_fastq/
├── 01_pilot_fastq/
├── 02_cellranger/
├── 03_cellbender/
├── 04_seurat_objects/
├── logs/
└── metadata/
```

---

## Notes

- This repository is designed for use on the **Minerva HPC cluster**
- Script headers contain required input paths and configuration details
- Documentation is intentionally modular to support reuse and adaptation across projects
